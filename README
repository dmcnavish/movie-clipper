```markdown
# ğŸ¬ Movie Clipper â€” TikTok Scene Generator

CLI tool to:
âœ… Programmatically download movies via torrents  
âœ… Ask ChatGPT for popular scenes (via `/v1/responses` API)  
âœ… Parse GPT scene timestamps  
âœ… Clip scenes directly from GPT timestamps  
âœ… Burn subtitles (optional, ON by default)  
âœ… Output vertical 1080x1920 (or custom scale) clips for TikTok  
âœ… Keeps previous runs safe by using unique filenames ğŸš€

---

## ğŸš€ How the architecture works

Single entry point:

```

index.js --action=...

````

Available actions:

| Action | What it does |
|--------|--------------|
| `download-movie` | Downloads any missing movies (via qBittorrent) |
| `clip-movie` | Clips scenes for movies |
| `all` | Runs both download + clip ğŸš€ |

---

## âš™ï¸ Setup (Mac)

### 1ï¸âƒ£ Install dependencies

```bash
# Install ffmpeg
brew install ffmpeg

# Install Python 3 (if not already installed)
brew install python

# Install Node.js dependencies
npm install
````

---

## ğŸ”‘ Set OpenAI API Key

This project uses **`/v1/responses` API**, which requires a **project key** (`sk-proj-xxx`).

```bash
export OPENAI_API_KEY=sk-proj-XXXXXXXXXXXXXXXXXXXXXXXX
```

---

## ğŸ Python Virtual Environment (venv) â€” Recommended

```bash
python3 -m venv venv
source venv/bin/activate
pip install scenedetect
```

---

## ğŸ¬ Run movie-clipper

### Download movies only

```bash
node index.js --action=download-movie
```

---

### Clip movies only

```bash
node index.js --action=clip-movie
```

---

### Run full pipeline (download + clip)

```bash
node index.js --action=all
```

---

### Other CLI options (work with `clip-movie` or `all`)

| Option                 | Description                                     |
| ---------------------- | ----------------------------------------------- |
| `--mock`               | Use mock static response (no API calls)         |
| `--no-subs`            | Disable subtitles in output clips               |
| `--max-scenes=N`       | Limit number of scenes to generate (default: 4) |
| `--scale=WIDTH:HEIGHT` | Set output resolution (default: 1080x1920)      |

---

### Example full run

```bash
source venv/bin/activate
node index.js --action=all --mock --max-scenes=2 --scale=540x960 --no-subs
```

---

## âœ… Example `movies.json`

```json
[
  {
    "title": "Night of the Living Dead",
    "version": "Original",
    "frame_rate": "24",
    "file_path": "./movies/night_of_the_living_dead.mp4",
    "magnet": "magnet:?xt=urn:btih:..."
  }
]
```

---

## ğŸš€ How torrent downloading works

1ï¸âƒ£ Uses **qBittorrent Web API**
2ï¸âƒ£ If movie file already exists â†’ skip download
3ï¸âƒ£ If not â†’ add magnet â†’ monitor progress â†’ download to `./movies/`
4ï¸âƒ£ When complete â†’ clip-movie will process ğŸš€

---

## ğŸš€ How clipping works

1ï¸âƒ£ Calls `/v1/responses` with movie title â†’ gets popular scenes with timestamps
2ï¸âƒ£ Parses GPT timestamps
3ï¸âƒ£ Clips directly from movie â†’ outputs to `./scenes/`

---

## ğŸš€ Output Files â€” Naming

âœ… If a clip with the same name already exists, a **timestamp** is added:

```text
House_on_Haunted_Hill_Scene1.mp4
House_on_Haunted_Hill_Scene1_1717194859123.mp4
```

âœ… Prevents ffmpeg hangs + saves all variations!

---

## ğŸ“‚ Folder Structure

```
movie-clipper/
â”œâ”€â”€ index.js                 # entry point
â”œâ”€â”€ downloadMovies.js        # download flow
â”œâ”€â”€ clipMovies.js            # clip flow
â”œâ”€â”€ utils/sceneHelpers.js    # helper functions
â”œâ”€â”€ movies.json              # movie list
â”œâ”€â”€ scenes/                  # output clips
â”œâ”€â”€ movies/                  # input movies
â””â”€â”€ venv/                    # Python venv
```

---


ğŸ” Managing Credentials

This project uses qBittorrent Web UI for automated downloads.
To keep credentials safe and out of code, we use a .env file.
ğŸš€ 1ï¸âƒ£ Create a .env file in project root:

# .env
QBITTORRENT_URL=http://localhost:8080

QBITTORRENT_USER=your_username 

QBITTORRENT_PASS=your_password

ğŸš€ 2ï¸âƒ£ Add .env to .gitignore

# .env should NOT be committed!
.env

ğŸš€ 3ï¸âƒ£ How it works

    The project uses dotenv package

    downloadMovies.js automatically loads .env and reads:

process.env.QBITTORRENT_URL
process.env.QBITTORRENT_USER
process.env.QBITTORRENT_PASS


